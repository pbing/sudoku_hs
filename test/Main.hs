module Main (main) where

import Test.Hspec

import Parser
import Sudoku

easy :: Grid
easy =
  [ "2....1.38",
    "........5",
    ".7...6...",
    ".......13",
    ".981..257",
    "31....8..",
    "9..8...2.",
    ".5..69784",
    "4..25...."
  ]

gentle :: Grid
gentle =
  [ ".1.42...5",
    "..2.71.39",
    ".......4.",
    "2.71....6",
    "....4....",
    "6....74.3",
    ".7.......",
    "12.73.5..",
    "3...82.7."
  ]

diabolical :: Grid
diabolical =
  [ ".9.7..86.",
    ".31..5.2.",
    "8.6......",
    "..7.5...6",
    "...3.7...",
    "5...1.7..",
    "......1.9",
    ".2.6..35.",
    ".54..8.7."
  ]

unsolvable :: Grid
unsolvable =
  [ "1..9.7..3",
    ".8.....7.",
    "..9...6..",
    "..72.94..",
    "41.....95",
    "..85.43..",
    "..3...7..",
    ".5.....4.",
    "2..8.6..9"
  ]

minimal :: Grid
minimal =
  [ ".98......",
    "....7....",
    "....15...",
    "1........",
    "...2....9",
    "...9.6.82",
    ".......3.",
    "5.1......",
    "...4...2."
  ]

main :: IO ()
main = hspec $ do
  describe "Single grid solutions" $ do
    it "easy" $ do
      solve easy
        `shouldBe` [ [ "249571638",
                       "861432975",
                       "573986142",
                       "725698413",
                       "698143257",
                       "314725869",
                       "937814526",
                       "152369784",
                       "486257391"
                     ]
                   ]
    it "gentle" $ do
      solve gentle
        `shouldBe` [ [ "813429765",
                       "462571839",
                       "795368142",
                       "247153986",
                       "539846217",
                       "681297453",
                       "978615324",
                       "126734598",
                       "354982671"
                     ]
                   ]
    it "diabolical" $ do
      solve diabolical
        `shouldBe` [ [ "295743861",
                       "431865927",
                       "876192543",
                       "387459216",
                       "612387495",
                       "549216738",
                       "763524189",
                       "928671354",
                       "154938672"
                     ]
                   ]
    it "unsolvable" $ do
      solve unsolvable
        `shouldBe` [ [ "164957283",
                       "385621974",
                       "729438651",
                       "537289416",
                       "412763895",
                       "698514327",
                       "843195762",
                       "956372148",
                       "271846539"
                     ]
                   ]
    it "minimal" $ do
      solve minimal
        `shouldBe` [ [ "798624315",
                       "315879246",
                       "264315978",
                       "129587463",
                       "683241759",
                       "457936182",
                       "942158637",
                       "531762894",
                       "876493521"
                     ]
                   ]
    it "blank" $ do
      (take 3 $ solve blank)
        `shouldBe` [ [ "123456789",
                       "456789123",
                       "789123456",
                       "214365897",
                       "365897214",
                       "897214365",
                       "531642978",
                       "642978531",
                       "978531642"
                     ],
                     [ "123456789",
                       "456789123",
                       "789123456",
                       "214365897",
                       "365897214",
                       "897214365",
                       "531642978",
                       "648971532",
                       "972538641"
                     ],
                     [ "123456789",
                       "456789123",
                       "789123456",
                       "214365897",
                       "365897214",
                       "897214365",
                       "531642978",
                       "672938541",
                       "948571632"
                     ]
                   ]

  describe "Parsing files" $ do
    it "sudoku-easy50" $ do
      grids <- parse "python/sudoku-easy50.txt"
      (take 2 $ grids)
        `shouldBe` [ [ "..3.2.6..",
                       "9..3.5..1",
                       "..18.64..",
                       "..81.29..",
                       "7.......8",
                       "..67.82..",
                       "..26.95..",
                       "8..2.3..9",
                       "..5.1.3.."
                     ],
                     [ "2...8.3..",
                       ".6..7..84",
                       ".3.5..2.9",
                       "...1.54.8",
                       ".........",
                       "4.27.6...",
                       "3.1..7.4.",
                       "72..4..6.",
                       "..4.1...3"
                     ]
                   ]
    it "sudoku-top95" $ do
      grids <- parse "python/sudoku-top95.txt"
      (take 2 $ grids)
        `shouldBe` [ [ "4.....8.5",
                       ".3.......",
                       "...7.....",
                       ".2.....6.",
                       "....8.4..",
                       "....1....",
                       "...6.3.7.",
                       "5..2.....",
                       "1.4......"
                     ],
                     [ "52...6...",
                       "......7.1",
                       "3........",
                       "...4..8..",
                       "6......5.",
                       ".........",
                       ".418.....",
                       "....3..2.",
                       "..87....."
                     ]
                   ]
    it "sudoku-hardest" $ do
      grids <- parse "python/sudoku-hardest.txt"
      (take 2 $ grids)
        `shouldBe` [ [ "85...24..",
                       "72......9",
                       "..4......",
                       "...1.7..2",
                       "3.5...9..",
                       ".4.......",
                       "....8..7.",
                       ".17......",
                       "....36.4."
                     ],
                     [ "..53.....",
                       "8......2.",
                       ".7..1.5..",
                       "4....53..",
                       ".1..7...6",
                       "..32...8.",
                       ".6.5....9",
                       "..4....3.",
                       ".....97.."
                     ]
                   ]
    it "sudoku-10k" $ do
      grids <- parse "python/sudoku-10k.txt"
      (take 2 $ grids)
        `shouldBe` [ [ "..7......",
                       "..1....3.",
                       ".5..4.6..",
                       ".4....7..",
                       ".6...3...",
                       ".....1..2",
                       ".....7...",
                       "....6..8.",
                       "..2.....1"
                     ],
                     [ "..3..2.8.",
                       "14......9",
                       ".68.593.7",
                       "..24.5...",
                       ".........",
                       "...2.85..",
                       "9.457.86.",
                       "6......75",
                       ".8.6..4.."
                     ]
                   ]
    it "sudoku-250k" $ do
      grids <- parse "python/sudoku-250k.txt"
      (drop (250000 - 2) $ grids)
        `shouldBe` [ [ ".....68.5",
                       "5......43",
                       "..1.....2",
                       "..7.9....",
                       ".3...27..",
                       "26..7....",
                       "..3......",
                       "1....8.64",
                       ".2..413.."
                     ],
                     [ ".1.......",
                       "..2.....6",
                       ".7.8...4.",
                       ".....5...",
                       "....71..2",
                       "8.3....6.",
                       ".........",
                       "4.6......",
                       "......1.5"
                     ]
                   ]
